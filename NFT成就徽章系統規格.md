# NFT æˆå°±å¾½ç« ç³»çµ± - è¦æ ¼æ›¸

## ç³»çµ±æ¦‚è¿°

æœ¬ç³»çµ±å°‡ä½¿ç”¨è€…çš„åƒæ‹œæˆå°±é‘„é€ æˆ NFT (Non-Fungible Token),æ°¸ä¹…è¨˜éŒ„åœ¨å€å¡Šéˆä¸Š,ä½œç‚ºæ•¸ä½ç´€å¿µå“ã€‚**é‡é»æ˜¯ç´€å¿µåƒ¹å€¼è€Œéäº¤æ˜“åŠŸèƒ½**,NFT ä¸å¯è½‰è®“,æ°¸ä¹…ç¶å®šåœ¨ä½¿ç”¨è€…çš„éŒ¢åŒ…åœ°å€ä¸Šã€‚

---

## æ ¸å¿ƒæ¦‚å¿µ

### ğŸ–ï¸ **æˆå°±å¾½ç« é¡å‹**

#### 1. **æ‰“å¡é‡Œç¨‹ç¢‘å¾½ç« **
- é¦–æ¬¡æ‰“å¡ç´€å¿µ
- æ‰“å¡ 10 æ¬¡
- æ‰“å¡ 50 æ¬¡
- æ‰“å¡ 100 æ¬¡
- æ‰“å¡ 365 æ¬¡(åœ“æ»¿ä¹‹å¹´)
- æ‰“å¡ 1000 æ¬¡(åƒé‡Œä¹‹è¡Œ)

#### 2. **å»Ÿå®‡æ”¶é›†å¾½ç« **
- åƒæ‹œ 5 åº§å»Ÿå®‡
- åƒæ‹œ 10 åº§å»Ÿå®‡
- åƒæ‹œ 25 åº§å»Ÿå®‡(å››åˆ†ä¹‹ä¸€æ”¶é›†å®¶)
- åƒæ‹œ 50 åº§å»Ÿå®‡(åŠæ•¸æ”¶é›†å®¶)
- åƒæ‹œå…¨éƒ¨å»Ÿå®‡(å®Œç¾æ”¶é›†å®¶)

#### 3. **é€£çºŒæ‰“å¡å¾½ç« **
- é€£çºŒæ‰“å¡ 7 å¤©
- é€£çºŒæ‰“å¡ 30 å¤©
- é€£çºŒæ‰“å¡ 100 å¤©
- é€£çºŒæ‰“å¡ 365 å¤©(å¹´åº¦è™”èª ä¿¡å¾’)

#### 4. **ç‰¹æ®Šæˆå°±å¾½ç« **
- å–®ä¸€å»Ÿå®‡æ‰“å¡ 50 æ¬¡(å°ˆå±¬ä¿¡å¾’)
- åœ¨åŒä¸€å¤©æ‰“å¡ 5 åº§å»Ÿå®‡(æœè–è€…)
- å‡Œæ™¨æ‰“å¡(æ—©èª²è™”èª )
- è¾²æ›†åˆä¸€ã€åäº”æ‰“å¡(é›™å€è™”èª )
- ç¥æ˜ç”Ÿæ—¥ç•¶å¤©æ‰“å¡(å£½æ˜Ÿç¥ç¦)

#### 5. **å»Ÿå®‡å°ˆå±¬å¾½ç« **
- é¾å±±å¯ºå°ˆå±¬å¾½ç« 
- è¡Œå¤©å®®å°ˆå±¬å¾½ç« 
- å„å»Ÿå®‡è‡ªè¨‚å¾½ç« 

#### 6. **å­£ç¯€/ç¯€æ…¶å¾½ç« **
- æ–°æ˜¥ç¥ˆç¦(è¾²æ›†æ–°å¹´)
- æ¸…æ˜ç¥­ç¥–
- ç«¯åˆç¥ˆå®‰
- ä¸­å…ƒæ™®æ¸¡
- ä¸­ç§‹ç¥ˆç¦
- å†¬è‡³åœ˜åœ“

#### 7. **åŠŸå¾·æˆå°±å¾½ç« **
- ç´¯ç© 1000 åŠŸå¾·å€¼
- ç´¯ç© 5000 åŠŸå¾·å€¼
- ç´¯ç© 10000 åŠŸå¾·å€¼

---

## æŠ€è¡“æ¶æ§‹

### å€å¡Šéˆé¸æ“‡å»ºè­°

#### ğŸŒŸ **æ¨è–¦æ–¹æ¡ˆ: Polygon (MATIC)**
**å„ªé»**:
- âœ… ä½ Gas Fee (å¹¾ä¹å…è²»)
- âœ… å¿«é€Ÿç¢ºèª (2ç§’)
- âœ… EVM ç›¸å®¹(èˆ‡ Ethereum ç”Ÿæ…‹ç³»çµ±ç›¸å®¹)
- âœ… ç’°ä¿(PoS æ©Ÿåˆ¶)
- âœ… å®Œå–„çš„ NFT ç”Ÿæ…‹ç³»çµ±
- âœ… æ”¯æ´ä¸­æ–‡ç¤¾ç¾¤

**æ›¿ä»£æ–¹æ¡ˆ**:
- **Solana**: æ›´å¿«æ›´ä¾¿å®œ,ä½†ç”Ÿæ…‹ç³»çµ±è¼ƒå°
- **BSC (Binance Smart Chain)**: ä¾¿å®œä½†è¼ƒä¸­å¿ƒåŒ–
- **Ethereum Layer 2** (Arbitrum/Optimism): æ›´å»ä¸­å¿ƒåŒ–ä½†ç¨è²´

---

### NFT æ¨™æº–

ä½¿ç”¨ **ERC-721** æ¨™æº–:
- æ¯å€‹å¾½ç« éƒ½æ˜¯å”¯ä¸€çš„ NFT
- åŒ…å«å®Œæ•´çš„æˆå°±è³‡è¨Š
- æ”¯æ´ Metadata æ“´å……

**æ™ºèƒ½åˆç´„ç‰¹æ€§**:
- âœ… **Soulbound Token** (éˆé­‚ç¶å®šä»£å¹£,ä¸å¯è½‰è®“)
- âœ… è‡ªå‹•é‘„é€ (é”æˆæˆå°±æ™‚è§¸ç™¼)
- âœ… æ°¸ä¹…ä¿ç•™(ç„¡æ³•éŠ·æ¯€)
- âœ… å¯æŸ¥è©¢(å…¬é–‹é©—è­‰)

---

## è³‡æ–™åº«è¨­è¨ˆ

### 1. achievement_types (æˆå°±é¡å‹è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | æˆå°±é¡å‹ UUID | PRIMARY KEY |
| code | VARCHAR(50) | æˆå°±ä»£ç¢¼ | UNIQUE, NOT NULL |
| name | VARCHAR(100) | æˆå°±åç¨± | NOT NULL |
| name_en | VARCHAR(100) | è‹±æ–‡åç¨± | NULL |
| description | TEXT | æˆå°±æè¿° | NULL |
| category | ENUM | æˆå°±åˆ†é¡ | NOT NULL |
| icon_url | VARCHAR(500) | å¾½ç« åœ–ç¤º URL | NULL |
| criteria | JSON | é”æˆæ¢ä»¶ | NOT NULL |
| rarity | ENUM | ç¨€æœ‰åº¦ | DEFAULT 'common' |
| points_reward | INT | çå‹µåŠŸå¾·å€¼ | DEFAULT 0 |
| is_active | BOOLEAN | æ˜¯å¦å•Ÿç”¨ | DEFAULT TRUE |
| display_order | INT | é¡¯ç¤ºé †åº | DEFAULT 0 |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**æˆå°±åˆ†é¡ (category)**:
- `checkin_milestone` - æ‰“å¡é‡Œç¨‹ç¢‘
- `temple_collection` - å»Ÿå®‡æ”¶é›†
- `consecutive_checkin` - é€£çºŒæ‰“å¡
- `special_achievement` - ç‰¹æ®Šæˆå°±
- `temple_exclusive` - å»Ÿå®‡å°ˆå±¬
- `seasonal` - å­£ç¯€ç¯€æ…¶
- `merit_points` - åŠŸå¾·æˆå°±

**ç¨€æœ‰åº¦ (rarity)**:
- `common` - æ™®é€š (ç™½è‰²)
- `uncommon` - å°‘è¦‹ (ç¶ è‰²)
- `rare` - ç¨€æœ‰ (è—è‰²)
- `epic` - å²è©© (ç´«è‰²)
- `legendary` - å‚³èªª (é‡‘è‰²)

**é”æˆæ¢ä»¶ (criteria)** JSON ç¯„ä¾‹:
```json
{
  "type": "checkin_count",
  "value": 100,
  "temple_id": null,  // null = ä»»ä½•å»Ÿå®‡
  "description": "ç´¯ç©æ‰“å¡ 100 æ¬¡"
}
```

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `code`
- INDEX: `category`, `is_active`, `rarity`

---

### 2. user_achievements (ä½¿ç”¨è€…æˆå°±è¨˜éŒ„è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | è¨˜éŒ„ UUID | PRIMARY KEY |
| user_id | VARCHAR(36) | ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| achievement_type_id | VARCHAR(36) | æˆå°±é¡å‹ ID | FOREIGN KEY â†’ achievement_types.id |
| unlocked_at | DATETIME | è§£é–æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| related_checkin_id | VARCHAR(36) | ç›¸é—œæ‰“å¡è¨˜éŒ„ | FOREIGN KEY â†’ checkins.id |
| related_temple_id | VARCHAR(36) | ç›¸é—œå»Ÿå®‡ | FOREIGN KEY â†’ temples.id |
| achievement_data | JSON | æˆå°±æ•¸æ“šå¿«ç…§ | NULL |
| is_minted | BOOLEAN | æ˜¯å¦å·²é‘„é€  NFT | DEFAULT FALSE |
| nft_id | VARCHAR(36) | NFT è¨˜éŒ„ ID | FOREIGN KEY â†’ nfts.id |

**æˆå°±æ•¸æ“šå¿«ç…§ (achievement_data)** JSON ç¯„ä¾‹:
```json
{
  "total_checkins": 100,
  "achievement_date": "2025-01-15",
  "progress": {
    "current": 100,
    "target": 100
  }
}
```

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `user_id, achievement_type_id` (æ¯å€‹ä½¿ç”¨è€…æ¯ç¨®æˆå°±åªèƒ½è§£é–ä¸€æ¬¡)
- INDEX: `user_id`, `achievement_type_id`, `unlocked_at`, `is_minted`
- FOREIGN KEY:
  - `user_id` REFERENCES `users(id)` ON DELETE CASCADE
  - `achievement_type_id` REFERENCES `achievement_types(id)` ON DELETE CASCADE
  - `related_checkin_id` REFERENCES `checkins(id)` ON DELETE SET NULL
  - `related_temple_id` REFERENCES `temples(id)` ON DELETE SET NULL
  - `nft_id` REFERENCES `nfts(id)` ON DELETE SET NULL

---

### 3. nfts (NFT è¨˜éŒ„è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | NFT è¨˜éŒ„ UUID | PRIMARY KEY |
| user_id | VARCHAR(36) | æ“æœ‰è€… ID | FOREIGN KEY â†’ users.id |
| achievement_id | VARCHAR(36) | æˆå°±è¨˜éŒ„ ID | FOREIGN KEY â†’ user_achievements.id |
| token_id | BIGINT | éˆä¸Š Token ID | NULL |
| contract_address | VARCHAR(42) | æ™ºèƒ½åˆç´„åœ°å€ | NULL |
| wallet_address | VARCHAR(42) | éŒ¢åŒ…åœ°å€ | NULL |
| blockchain | VARCHAR(20) | å€å¡Šéˆç¶²è·¯ | DEFAULT 'polygon' |
| transaction_hash | VARCHAR(66) | äº¤æ˜“é›œæ¹Š | NULL |
| metadata_uri | VARCHAR(500) | Metadata URI | NULL |
| image_url | VARCHAR(500) | NFT åœ–ç‰‡ URL | NULL |
| status | ENUM | é‘„é€ ç‹€æ…‹ | DEFAULT 'pending' |
| minted_at | DATETIME | é‘„é€ æ™‚é–“ | NULL |
| error_message | TEXT | éŒ¯èª¤è¨Šæ¯ | NULL |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**å€å¡Šéˆç¶²è·¯ (blockchain)**:
- `polygon` - Polygon (MATIC)
- `ethereum` - Ethereum
- `bsc` - Binance Smart Chain
- `solana` - Solana

**é‘„é€ ç‹€æ…‹ (status)**:
- `pending` - å¾…é‘„é€ 
- `minting` - é‘„é€ ä¸­
- `minted` - å·²é‘„é€ 
- `failed` - é‘„é€ å¤±æ•—

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `achievement_id` (æ¯å€‹æˆå°±åªèƒ½é‘„é€ ä¸€æ¬¡)
- INDEX: `user_id`, `token_id`, `status`, `blockchain`
- INDEX: `transaction_hash`, `wallet_address`
- FOREIGN KEY:
  - `user_id` REFERENCES `users(id)` ON DELETE CASCADE
  - `achievement_id` REFERENCES `user_achievements(id)` ON DELETE CASCADE

---

### 4. nft_metadata (NFT Metadata è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | Metadata UUID | PRIMARY KEY |
| nft_id | VARCHAR(36) | NFT è¨˜éŒ„ ID | FOREIGN KEY â†’ nfts.id |
| name | VARCHAR(200) | NFT åç¨± | NOT NULL |
| description | TEXT | NFT æè¿° | NULL |
| image | VARCHAR(500) | åœ–ç‰‡ URL | NOT NULL |
| external_url | VARCHAR(500) | å¤–éƒ¨é€£çµ | NULL |
| attributes | JSON | å±¬æ€§åˆ—è¡¨ | NULL |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**å±¬æ€§ (attributes)** JSON ç¯„ä¾‹ (ç¬¦åˆ OpenSea æ¨™æº–):
```json
[
  {
    "trait_type": "æˆå°±é¡å‹",
    "value": "æ‰“å¡é‡Œç¨‹ç¢‘"
  },
  {
    "trait_type": "ç¨€æœ‰åº¦",
    "value": "ç¨€æœ‰"
  },
  {
    "trait_type": "è§£é–æ—¥æœŸ",
    "value": "2025-01-15"
  },
  {
    "trait_type": "å»Ÿå®‡",
    "value": "é¾å±±å¯º"
  },
  {
    "trait_type": "ç¸½æ‰“å¡æ¬¡æ•¸",
    "value": 100,
    "display_type": "number"
  },
  {
    "trait_type": "å¹´ä»½",
    "value": "2025"
  }
]
```

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `nft_id`
- FOREIGN KEY: `nft_id` REFERENCES `nfts(id)` ON DELETE CASCADE

---

### 5. wallet_connections (éŒ¢åŒ…é€£æ¥è¨˜éŒ„è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | è¨˜éŒ„ UUID | PRIMARY KEY |
| user_id | VARCHAR(36) | ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| wallet_address | VARCHAR(42) | éŒ¢åŒ…åœ°å€ | NOT NULL |
| blockchain | VARCHAR(20) | å€å¡Šéˆç¶²è·¯ | NOT NULL |
| is_primary | BOOLEAN | æ˜¯å¦ç‚ºä¸»è¦éŒ¢åŒ… | DEFAULT FALSE |
| verified_at | DATETIME | é©—è­‰æ™‚é–“ | NULL |
| last_used | DATETIME | æœ€å¾Œä½¿ç”¨æ™‚é–“ | NULL |
| created_at | DATETIME | é€£æ¥æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `wallet_address, blockchain` (åŒä¸€éŒ¢åŒ…åªèƒ½ç¶å®šä¸€å€‹å¸³è™Ÿ)
- INDEX: `user_id`, `is_primary`
- FOREIGN KEY: `user_id` REFERENCES `users(id)` ON DELETE CASCADE

---

## API ç«¯é»è¦æ ¼

### ğŸ–ï¸ **æˆå°±ç³»çµ± API**

#### 1. å–å¾—æ‰€æœ‰æˆå°±é¡å‹
```
GET /api/achievements/types
```

**èªè­‰**: ä¸éœ€è¦

**æŸ¥è©¢åƒæ•¸**:
- `category`: ç¯©é¸æˆå°±åˆ†é¡
- `rarity`: ç¯©é¸ç¨€æœ‰åº¦

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "code": "CHECKIN_100",
      "name": "ç™¾æ¬¡åƒæ‹œ",
      "description": "ç´¯ç©æ‰“å¡ 100 æ¬¡",
      "category": "checkin_milestone",
      "icon_url": "https://cdn.example.com/badges/checkin_100.png",
      "rarity": "rare",
      "points_reward": 100,
      "criteria": {
        "type": "checkin_count",
        "value": 100
      }
    }
  ]
}
```

---

#### 2. å–å¾—ä½¿ç”¨è€…å·²è§£é–æˆå°±
```
GET /api/achievements/my-achievements
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_unlocked": 15,
    "achievements": [
      {
        "id": "uuid",
        "achievement": {
          "code": "CHECKIN_100",
          "name": "ç™¾æ¬¡åƒæ‹œ",
          "icon_url": "...",
          "rarity": "rare"
        },
        "unlocked_at": "2025-01-15T10:30:00",
        "is_minted": true,
        "nft": {
          "token_id": 12345,
          "blockchain": "polygon",
          "view_url": "https://opensea.io/assets/..."
        }
      }
    ],
    "progress": [
      {
        "achievement": {
          "code": "CHECKIN_1000",
          "name": "åƒé‡Œä¹‹è¡Œ",
          "rarity": "legendary"
        },
        "current": 150,
        "target": 1000,
        "percentage": 15
      }
    ]
  }
}
```

---

#### 3. å–å¾—æˆå°±é€²åº¦
```
GET /api/achievements/progress
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**èªªæ˜**: æŸ¥çœ‹æ‰€æœ‰æœªè§£é–æˆå°±çš„é€²åº¦

---

#### 4. æª¢æŸ¥æ–°è§£é–çš„æˆå°±
```
POST /api/achievements/check
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**èªªæ˜**: æ‰“å¡å¾Œè‡ªå‹•è§¸ç™¼,æª¢æŸ¥æ˜¯å¦æœ‰æ–°æˆå°±è§£é–

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "new_achievements": [
      {
        "achievement": {
          "name": "ç™¾æ¬¡åƒæ‹œ",
          "description": "ç´¯ç©æ‰“å¡ 100 æ¬¡",
          "icon_url": "...",
          "rarity": "rare"
        },
        "points_reward": 100,
        "can_mint_nft": true
      }
    ]
  }
}
```

---

### ğŸ”— **éŒ¢åŒ…é€£æ¥ API**

#### 5. é€£æ¥éŒ¢åŒ…
```
POST /api/wallet/connect
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
  "blockchain": "polygon",
  "signature": "0x...",  // ç°½åé©—è­‰
  "message": "I am connecting my wallet to Temple Checkin App"
}
```

**èªªæ˜**: 
1. å‰ç«¯ä½¿ç”¨ Web3 éŒ¢åŒ… (MetaMask) ç°½ç½²è¨Šæ¯
2. å¾Œç«¯é©—è­‰ç°½åç¢ºèªéŒ¢åŒ…æ‰€æœ‰æ¬Š
3. ç¶å®šéŒ¢åŒ…åˆ°ä½¿ç”¨è€…å¸³è™Ÿ

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "éŒ¢åŒ…é€£æ¥æˆåŠŸ",
  "data": {
    "wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
    "blockchain": "polygon",
    "is_primary": true
  }
}
```

---

#### 6. å–å¾—å·²é€£æ¥çš„éŒ¢åŒ…
```
GET /api/wallet/my-wallets
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb",
      "blockchain": "polygon",
      "is_primary": true,
      "verified_at": "2025-01-15T10:00:00",
      "nft_count": 5
    }
  ]
}
```

---

#### 7. è¨­å®šä¸»è¦éŒ¢åŒ…
```
PUT /api/wallet/set-primary
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "wallet_id": "uuid"
}
```

---

#### 8. ç§»é™¤éŒ¢åŒ…é€£æ¥
```
DELETE /api/wallet/<wallet_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**èªªæ˜**: ç§»é™¤éŒ¢åŒ…ç¶å®š,ä½†å·²é‘„é€ çš„ NFT ä»ä¿ç•™åœ¨å€å¡Šéˆä¸Š

---

### ğŸ¨ **NFT é‘„é€  API**

#### 9. é‘„é€ æˆå°± NFT
```
POST /api/nft/mint
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "achievement_id": "uuid",
  "wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"
}
```

**å•†æ¥­é‚è¼¯**:
1. æª¢æŸ¥ä½¿ç”¨è€…æ˜¯å¦å·²è§£é–è©²æˆå°±
2. æª¢æŸ¥è©²æˆå°±æ˜¯å¦å·²é‘„é€ é
3. æª¢æŸ¥éŒ¢åŒ…æ˜¯å¦å·²é€£æ¥
4. å‘¼å«æ™ºèƒ½åˆç´„é‘„é€  NFT
5. è¨˜éŒ„äº¤æ˜“é›œæ¹Šå’Œ Token ID
6. æ›´æ–°æˆå°±è¨˜éŒ„çš„ is_minted ç‹€æ…‹

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "NFT é‘„é€ ä¸­,è«‹ç¨å€™...",
  "data": {
    "nft_id": "uuid",
    "status": "minting",
    "transaction_hash": "0x...",
    "estimated_time": "30 seconds"
  }
}
```

---

#### 10. æ‰¹é‡é‘„é€  NFT
```
POST /api/nft/batch-mint
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "achievement_ids": ["uuid1", "uuid2", "uuid3"],
  "wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb"
}
```

**èªªæ˜**: ä¸€æ¬¡é‘„é€ å¤šå€‹æˆå°± NFT,ç¯€çœ Gas Fee

---

#### 11. æŸ¥è©¢ NFT é‘„é€ ç‹€æ…‹
```
GET /api/nft/<nft_id>/status
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "nft_id": "uuid",
    "status": "minted",
    "token_id": 12345,
    "blockchain": "polygon",
    "contract_address": "0x...",
    "transaction_hash": "0x...",
    "minted_at": "2025-01-15T10:35:00",
    "view_url": "https://opensea.io/assets/polygon/0x.../12345",
    "metadata": {
      "name": "ç™¾æ¬¡åƒæ‹œæˆå°±",
      "image": "https://cdn.example.com/nft/12345.png"
    }
  }
}
```

---

#### 12. å–å¾—ä½¿ç”¨è€…çš„æ‰€æœ‰ NFT
```
GET /api/nft/my-nfts
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**æŸ¥è©¢åƒæ•¸**:
- `blockchain`: ç¯©é¸å€å¡Šéˆ
- `status`: ç¯©é¸ç‹€æ…‹

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_nfts": 5,
    "nfts": [
      {
        "nft_id": "uuid",
        "achievement": {
          "name": "ç™¾æ¬¡åƒæ‹œ",
          "rarity": "rare"
        },
        "token_id": 12345,
        "blockchain": "polygon",
        "minted_at": "2025-01-15T10:35:00",
        "view_url": "https://opensea.io/assets/...",
        "image_url": "https://cdn.example.com/nft/12345.png"
      }
    ]
  }
}
```

---

#### 13. å–å¾— NFT Metadata
```
GET /api/nft/metadata/<token_id>
```

**èªè­‰**: ä¸éœ€è¦ (å…¬é–‹ç«¯é»,ä¾›å€å¡Šéˆç€è¦½å™¨æŸ¥è©¢)

**èªªæ˜**: è¿”å›ç¬¦åˆ ERC-721 æ¨™æº–çš„ Metadata JSON

**å›æ‡‰ç¯„ä¾‹** (ç¬¦åˆ OpenSea æ¨™æº–):
```json
{
  "name": "ç™¾æ¬¡åƒæ‹œæˆå°± #12345",
  "description": "æ­å–œæ‚¨é”æˆç™¾æ¬¡åƒæ‹œçš„é‡Œç¨‹ç¢‘!é€™æ˜¯æ‚¨è™”èª ä¿¡ä»°çš„è­‰æ˜ã€‚",
  "image": "https://cdn.example.com/nft/12345.png",
  "external_url": "https://temple-checkin.app/achievements/12345",
  "attributes": [
    {
      "trait_type": "æˆå°±é¡å‹",
      "value": "æ‰“å¡é‡Œç¨‹ç¢‘"
    },
    {
      "trait_type": "ç¨€æœ‰åº¦",
      "value": "ç¨€æœ‰"
    },
    {
      "trait_type": "è§£é–æ—¥æœŸ",
      "value": "2025-01-15"
    },
    {
      "trait_type": "ç¸½æ‰“å¡æ¬¡æ•¸",
      "value": 100,
      "display_type": "number"
    },
    {
      "trait_type": "åƒæ‹œå»Ÿå®‡æ•¸",
      "value": 15,
      "display_type": "number"
    }
  ],
  "background_color": "FFD700"
}
```

---

### ğŸ **ç®¡ç†å“¡ API**

#### 14. æ–°å¢æˆå°±é¡å‹ (ç³»çµ±ç®¡ç†å“¡)
```
POST /api/admin/achievements/types
```

**èªè­‰**: éœ€è¦ (ç³»çµ±ç®¡ç†å“¡)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "code": "TEMPLE_50",
  "name": "äº”åå»Ÿå·¡ç¦®",
  "description": "åƒæ‹œ 50 åº§ä¸åŒçš„å»Ÿå®‡",
  "category": "temple_collection",
  "rarity": "epic",
  "criteria": {
    "type": "unique_temples",
    "value": 50
  },
  "points_reward": 500,
  "icon_url": "https://..."
}
```

---

#### 15. æ‰‹å‹•è§£é–æˆå°± (ç³»çµ±ç®¡ç†å“¡)
```
POST /api/admin/achievements/unlock
```

**èªè­‰**: éœ€è¦ (ç³»çµ±ç®¡ç†å“¡)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "user_id": "uuid",
  "achievement_type_id": "uuid",
  "reason": "è£œç™¼éºå¤±çš„æˆå°±"
}
```

---

#### 16. æŸ¥çœ‹ NFT é‘„é€ çµ±è¨ˆ (ç³»çµ±ç®¡ç†å“¡)
```
GET /api/admin/nft/statistics
```

**èªè­‰**: éœ€è¦ (ç³»çµ±ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "total_achievements_unlocked": 5000,
    "total_nfts_minted": 3500,
    "minting_rate": 70,
    "by_rarity": {
      "common": 2000,
      "uncommon": 800,
      "rare": 500,
      "epic": 150,
      "legendary": 50
    },
    "by_blockchain": {
      "polygon": 3400,
      "ethereum": 100
    },
    "failed_mints": 25
  }
}
```

---

## æ™ºèƒ½åˆç´„è¨­è¨ˆ

### Solidity æ™ºèƒ½åˆç´„ç¯„ä¾‹ (ERC-721 Soulbound)

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC721/ERC721.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/utils/Counters.sol";

/**
 * @title TempleAchievementNFT
 * @dev Soulbound Token (ä¸å¯è½‰è®“çš„æˆå°± NFT)
 */
contract TempleAchievementNFT is ERC721, Ownable {
    using Counters for Counters.Counter;
    Counters.Counter private _tokenIds;
    
    // Token ID å°æ‡‰çš„ Metadata URI
    mapping(uint256 => string) private _tokenURIs;
    
    // è¨˜éŒ„æ¯å€‹åœ°å€æ“æœ‰çš„ Token
    mapping(address => uint256[]) private _ownedTokens;
    
    // äº‹ä»¶
    event AchievementMinted(address indexed to, uint256 indexed tokenId, string metadataURI);
    
    constructor() ERC721("Temple Achievement NFT", "ACHIEVE") {}
    
    /**
     * @dev é‘„é€ æ–°çš„æˆå°± NFT
     * @param to æ¥æ”¶è€…åœ°å€
     * @param metadataURI Metadata URI
     * @return tokenId æ–°é‘„é€ çš„ Token ID
     */
    function mintAchievement(address to, string memory metadataURI) 
        public 
        onlyOwner 
        returns (uint256) 
    {
        _tokenIds.increment();
        uint256 newTokenId = _tokenIds.current();
        
        _mint(to, newTokenId);
        _setTokenURI(newTokenId, metadataURI);
        _ownedTokens[to].push(newTokenId);
        
        emit AchievementMinted(to, newTokenId, metadataURI);
        
        return newTokenId;
    }
    
    /**
     * @dev æ‰¹é‡é‘„é€ 
     */
    function batchMintAchievements(address to, string[] memory metadataURIs) 
        public 
        onlyOwner 
        returns (uint256[] memory) 
    {
        uint256[] memory tokenIds = new uint256[](metadataURIs.length);
        
        for (uint256 i = 0; i < metadataURIs.length; i++) {
            tokenIds[i] = mintAchievement(to, metadataURIs[i]);
        }
        
        return tokenIds;
    }
    
    /**
     * @dev è¨­å®š Token URI
     */
    function _setTokenURI(uint256 tokenId, string memory _tokenURI) internal {
        require(_exists(tokenId), "Token does not exist");
        _tokenURIs[tokenId] = _tokenURI;
    }
    
    /**
     * @dev å–å¾— Token URI
     */
    function tokenURI(uint256 tokenId) 
        public 
        view 
        virtual 
        override 
        returns (string memory) 
    {
        require(_exists(tokenId), "Token does not exist");
        return _tokenURIs[tokenId];
    }
    
    /**
     * @dev å–å¾—åœ°å€æ“æœ‰çš„æ‰€æœ‰ Token
     */
    function tokensOfOwner(address owner) public view returns (uint256[] memory) {
        return _ownedTokens[owner];
    }
    
    /**
     * @dev ç¦æ­¢è½‰è®“ (Soulbound Token)
     */
    function _beforeTokenTransfer(
        address from,
        address to,
        uint256 tokenId
    ) internal virtual override {
        // åªå…è¨±é‘„é€  (from == address(0)),ç¦æ­¢è½‰è®“
        require(from == address(0), "Soulbound: Transfer not allowed");
        super._beforeTokenTransfer(from, to, tokenId);
    }
    
    /**
     * @dev å–å¾—ç¸½ä¾›æ‡‰é‡
     */
    function totalSupply() public view returns (uint256) {
        return _tokenIds.current();
    }
}
```

---

## å‰ç«¯æ•´åˆ

### React + Web3.js ç¯„ä¾‹

```javascript
import Web3 from 'web3';
import { useState, useEffect } from 'react';

// 1. é€£æ¥ MetaMask éŒ¢åŒ…
async function connectWallet() {
  if (window.ethereum) {
    try {
      const web3 = new Web3(window.ethereum);
      const accounts = await window.ethereum.request({ 
        method: 'eth_requestAccounts' 
      });
      
      const walletAddress = accounts[0];
      
      // ç°½ç½²è¨Šæ¯é©—è­‰éŒ¢åŒ…æ‰€æœ‰æ¬Š
      const message = "I am connecting my wallet to Temple Checkin App";
      const signature = await web3.eth.personal.sign(message, walletAddress);
      
      // ç™¼é€åˆ°å¾Œç«¯é©—è­‰ä¸¦ç¶å®š
      const response = await fetch('/api/wallet/connect', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('access_token')}`
        },
        body: JSON.stringify({
          wallet_address: walletAddress,
          blockchain: 'polygon',
          signature: signature,
          message: message
        })
      });
      
      const data = await response.json();
      return data;
      
    } catch (error) {
      console.error('éŒ¢åŒ…é€£æ¥å¤±æ•—:', error);
    }
  } else {
    alert('è«‹å®‰è£ MetaMask!');
  }
}

// 2. é‘„é€  NFT
async function mintNFT(achievementId, walletAddress) {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch('/api/nft/mint', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      achievement_id: achievementId,
      wallet_address: walletAddress
    })
  });
  
  const data = await response.json();
  
  if (data.success) {
    // é–‹å§‹è¼ªè©¢æª¢æŸ¥é‘„é€ ç‹€æ…‹
    const nftId = data.data.nft_id;
    pollMintStatus(nftId);
  }
  
  return data;
}

// 3. è¼ªè©¢é‘„é€ ç‹€æ…‹
async function pollMintStatus(nftId) {
  const token = localStorage.getItem('access_token');
  
  const checkStatus = async () => {
    const response = await fetch(`/api/nft/${nftId}/status`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    });
    
    const data = await response.json();
    
    if (data.data.status === 'minted') {
      console.log('NFT é‘„é€ æˆåŠŸ!', data.data);
      return data.data;
    } else if (data.data.status === 'failed') {
      console.error('NFT é‘„é€ å¤±æ•—:', data.data.error_message);
      return null;
    } else {
      // ç¹¼çºŒè¼ªè©¢
      setTimeout(checkStatus, 5000); // æ¯ 5 ç§’æª¢æŸ¥ä¸€æ¬¡
    }
  };
  
  return checkStatus();
}

// 4. é¡¯ç¤ºæˆå°±å¾½ç« çµ„ä»¶
function AchievementBadge({ achievement }) {
  const [minting, setMinting] = useState(false);
  const [walletAddress, setWalletAddress] = useState(null);
  
  useEffect(() => {
    // å–å¾—å·²é€£æ¥çš„éŒ¢åŒ…
    fetchWallet();
  }, []);
  
  const fetchWallet = async () => {
    const response = await fetch('/api/wallet/my-wallets', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
      }
    });
    const data = await response.json();
    if (data.data.length > 0) {
      setWalletAddress(data.data[0].wallet_address);
    }
  };
  
  const handleMint = async () => {
    if (!walletAddress) {
      const result = await connectWallet();
      if (result.success) {
        setWalletAddress(result.data.wallet_address);
      }
      return;
    }
    
    setMinting(true);
    const result = await mintNFT(achievement.id, walletAddress);
    
    if (result.success) {
      alert('NFT é‘„é€ ä¸­,è«‹ç¨å€™...');
    }
    setMinting(false);
  };
  
  return (
    <div className="achievement-badge">
      <img src={achievement.achievement.icon_url} alt={achievement.achievement.name} />
      <h3>{achievement.achievement.name}</h3>
      <p>{achievement.achievement.description}</p>
      <span className={`rarity ${achievement.achievement.rarity}`}>
        {achievement.achievement.rarity}
      </span>
      
      {!achievement.is_minted ? (
        <button onClick={handleMint} disabled={minting}>
          {minting ? 'é‘„é€ ä¸­...' : 'é‘„é€ ç‚º NFT'}
        </button>
      ) : (
        <div className="nft-info">
          <p>âœ… å·²é‘„é€ ç‚º NFT</p>
          <a href={achievement.nft.view_url} target="_blank" rel="noopener noreferrer">
            åœ¨ OpenSea æŸ¥çœ‹
          </a>
        </div>
      )}
    </div>
  );
}

// 5. æˆå°±å±•ç¤ºç‰†çµ„ä»¶
function AchievementWall() {
  const [achievements, setAchievements] = useState([]);
  const [progress, setProgress] = useState([]);
  
  useEffect(() => {
    fetchAchievements();
  }, []);
  
  const fetchAchievements = async () => {
    const response = await fetch('/api/achievements/my-achievements', {
      headers: {
        'Authorization': `Bearer ${localStorage.getItem('access_token')}`
      }
    });
    
    const data = await response.json();
    setAchievements(data.data.achievements);
    setProgress(data.data.progress);
  };
  
  return (
    <div className="achievement-wall">
      <h2>æˆ‘çš„æˆå°± ({achievements.length})</h2>
      
      <div className="unlocked-achievements">
        <h3>å·²è§£é–</h3>
        <div className="badge-grid">
          {achievements.map(achievement => (
            <AchievementBadge key={achievement.id} achievement={achievement} />
          ))}
        </div>
      </div>
      
      <div className="achievement-progress">
        <h3>é€²è¡Œä¸­</h3>
        {progress.map(item => (
          <div key={item.achievement.code} className="progress-item">
            <h4>{item.achievement.name}</h4>
            <div className="progress-bar">
              <div 
                className="progress-fill" 
                style={{ width: `${item.percentage}%` }}
              />
            </div>
            <span>{item.current} / {item.target}</span>
          </div>
        ))}
      </div>
    </div>
  );
}
```

---

## æ¥­å‹™æµç¨‹

### æˆå°±è§£é–æµç¨‹
```
1. ä½¿ç”¨è€…æ‰“å¡
   â†“
2. ç³»çµ±æª¢æŸ¥æ˜¯å¦é”æˆæ–°æˆå°±
   â†“
3. è§£é–æˆå°±ä¸¦è¨˜éŒ„åˆ° user_achievements
   â†“
4. ç™¼é€é€šçŸ¥çµ¦ä½¿ç”¨è€…
   â†“
5. æç¤ºä½¿ç”¨è€…å¯é‘„é€  NFT
```

### NFT é‘„é€ æµç¨‹
```
1. ä½¿ç”¨è€…é»æ“Šã€Œé‘„é€  NFTã€
   â†“
2. æª¢æŸ¥æ˜¯å¦å·²é€£æ¥éŒ¢åŒ… (æœªé€£æ¥å‰‡å¼•å°é€£æ¥)
   â†“
3. ç”Ÿæˆ NFT Metadata ä¸¦ä¸Šå‚³åˆ° IPFS
   â†“
4. å‘¼å«æ™ºèƒ½åˆç´„ mintAchievement()
   â†“
5. ç­‰å¾…äº¤æ˜“ç¢ºèª (ç´„ 30 ç§’)
   â†“
6. è¨˜éŒ„ Token ID å’Œäº¤æ˜“é›œæ¹Š
   â†“
7. æ›´æ–°æˆå°±è¨˜éŒ„ç‚ºå·²é‘„é€ 
   â†“
8. é€šçŸ¥ä½¿ç”¨è€…é‘„é€ æˆåŠŸ
```

---

## æˆæœ¬åˆ†æ

### Polygon ç¶²è·¯ (å»ºè­°ä½¿ç”¨)
- **é‘„é€ å–®å€‹ NFT**: ~$0.01 - $0.05 USD
- **æ‰¹é‡é‘„é€  (10å€‹)**: ~$0.05 - $0.15 USD
- **éŒ¢åŒ…é€£æ¥é©—è­‰**: å…è²» (ä¸ä¸Šéˆ)

### ç³»çµ±æ‰¿æ“” vs ä½¿ç”¨è€…è‡ªä»˜
**å»ºè­°æ–¹æ¡ˆ**: ç³»çµ±æ‰¿æ“”é‘„é€ è²»ç”¨
- æå‡ä½¿ç”¨è€…é«”é©—
- é¼“å‹µä½¿ç”¨è€…é‘„é€  NFT
- æˆæœ¬å¯æ§ (æ¯æœˆç´„ $50-200 USD for 1000-5000 NFTs)

**æ›¿ä»£æ–¹æ¡ˆ**: ä½¿ç”¨è€…è‡ªä»˜
- ä½¿ç”¨è€…éœ€è¦åœ¨éŒ¢åŒ…ä¸­æœ‰å°‘é‡ MATIC
- é™ä½ç³»çµ±æˆæœ¬
- å¯èƒ½é™ä½é‘„é€ æ„é¡˜

---

## åœ–ç‰‡è³‡æºè¨­è¨ˆ

### NFT å¾½ç« è¨­è¨ˆå»ºè­°
1. **çµ±ä¸€é¢¨æ ¼**: ä½¿ç”¨å°ç£å»Ÿå®‡å…ƒç´ (ç‡ˆç± ã€é¦™çˆã€ç¥åƒç­‰)
2. **ç¨€æœ‰åº¦å€åˆ†**: 
   - æ™®é€š: ç°ç™½è‰²èƒŒæ™¯
   - å°‘è¦‹: ç¶ è‰²å…‰èŠ’
   - ç¨€æœ‰: è—è‰²å…‰èŠ’ + èŠ±ç´‹
   - å²è©©: ç´«è‰²å…‰èŠ’ + å‹•æ…‹æ•ˆæœ
   - å‚³èªª: é‡‘è‰²å…‰èŠ’ + ç‰¹æ•ˆ

3. **åœ–ç‰‡è¦æ ¼**:
   - å°ºå¯¸: 512x512 px (OpenSea æ¨™æº–)
   - æ ¼å¼: PNG (é€æ˜èƒŒæ™¯)
   - æª”æ¡ˆå¤§å°: < 1MB

4. **ç¯„ä¾‹å…ƒç´ **:
   - èƒŒæ™¯: å»Ÿå®‡å»ºç¯‰è¼ªå»“
   - ä¸»é«”: æˆå°±åœ–ç¤º(æ•¸å­—ã€ç¥åƒã€é¦™çˆç­‰)
   - è£é£¾: ç¥¥é›²ã€é‡‘é‚Šã€å…‰èŠ’æ•ˆæœ
   - æ–‡å­—: æˆå°±åç¨±(ä¸­è‹±æ–‡)

---

## å®‰å…¨æ€§è€ƒé‡

### 1. éŒ¢åŒ…é©—è­‰
- ç°½åé©—è­‰ç¢ºä¿éŒ¢åŒ…æ‰€æœ‰æ¬Š
- ä¸€å€‹éŒ¢åŒ…åªèƒ½ç¶å®šä¸€å€‹å¸³è™Ÿ
- é˜²æ­¢å†’ç”¨ä»–äººéŒ¢åŒ…

### 2. é˜²æ­¢é‡è¤‡é‘„é€ 
- æ¯å€‹æˆå°±åªèƒ½é‘„é€ ä¸€æ¬¡
- è³‡æ–™åº«å”¯ä¸€ç´¢å¼•ç´„æŸ
- æ™ºèƒ½åˆç´„å±¤é¢æª¢æŸ¥

### 3. Metadata å®‰å…¨
- ä½¿ç”¨ IPFS å„²å­˜,é˜²æ­¢ç«„æ”¹
- å‚™ä»½åˆ°ä¸­å¿ƒåŒ–ä¼ºæœå™¨
- å®šæœŸæª¢æŸ¥ IPFS ç¯€é»ç‹€æ…‹

### 4. ç§é‘°ç®¡ç†
- ç³»çµ±ç†±éŒ¢åŒ…ç®¡ç†
- å¤šé‡ç°½åä¿è­·
- å®šæœŸè¼ªæ›
- å†·éŒ¢åŒ…å‚™ä»½

---

## æœªä¾†æ“´å……å»ºè­°

### 1. ç¤¾äº¤åŠŸèƒ½
- æˆå°±å±•ç¤ºç‰†
- åˆ†äº«åˆ°ç¤¾ç¾¤åª’é«”
- æˆå°±æ’è¡Œæ¦œ
- å¥½å‹æˆå°±æ¯”è¼ƒ

### 2. é€²éšå¾½ç« 
- å‹•æ…‹ NFT (å¯å‡ç´š)
- çµ„åˆå¾½ç«  (é›†æ»¿ä¸€å¥—è§£é–ç‰¹æ®Šå¾½ç« )
- éš±è—æˆå°±

### 3. å¯¦é«”æ‡‰ç”¨
- NFT å…Œæ›å¯¦é«”å¾½ç« 
- åƒåŠ å»Ÿå®‡æ´»å‹•æ†‘è­‰
- æœƒå“¡èº«ä»½è­˜åˆ¥

### 4. è·¨éˆæ”¯æ´
- æ”¯æ´å¤šå€‹å€å¡Šéˆ
- è·¨éˆæ©‹æ¥
- Layer 2 æ–¹æ¡ˆ

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-01-15
