# å»Ÿæ–¹ç®¡ç†ç³»çµ± - åŠŸèƒ½è¦æ ¼æ›¸

## ç³»çµ±æ¦‚è¿°

ç‚ºå»Ÿå®‡ç®¡ç†è€…æä¾›å®Œæ•´çš„å¾Œå°ç®¡ç†åŠŸèƒ½,åŒ…æ‹¬å»Ÿå®‡è³‡è¨Šç®¡ç†ã€è¨ªå®¢æ•¸æ“šåˆ†æã€å•†å“ç®¡ç†ã€æ´»å‹•å…¬å‘Šç­‰åŠŸèƒ½ã€‚

---

## ä½¿ç”¨è€…è§’è‰²å®šç¾©

### å»Ÿæ–¹ç®¡ç†å“¡ (Temple Admin)
- å¯ç®¡ç†ç‰¹å®šå»Ÿå®‡çš„æ‰€æœ‰è³‡è¨Š
- å¯æŸ¥çœ‹è©²å»Ÿå®‡çš„çµ±è¨ˆæ•¸æ“š
- å¯ç™¼å¸ƒå…¬å‘Šå’Œç®¡ç†å•†å“
- ä¸€å€‹å»Ÿå®‡å¯ä»¥æœ‰å¤šå€‹ç®¡ç†å“¡
- ä¸€å€‹ç®¡ç†å“¡å¯ä»¥ç®¡ç†å¤šå€‹å»Ÿå®‡

---

## è³‡æ–™åº«è¨­è¨ˆ

### 1. temple_admins (å»Ÿå®‡ç®¡ç†å“¡é—œè¯è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | UUID | PRIMARY KEY |
| temple_id | VARCHAR(36) | å»Ÿå®‡ ID | FOREIGN KEY â†’ temples.id |
| user_id | VARCHAR(36) | ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| role | ENUM | è§’è‰² | NOT NULL |
| permissions | JSON | æ¬Šé™è¨­å®š | NULL |
| is_active | BOOLEAN | æ˜¯å¦å•Ÿç”¨ | DEFAULT TRUE |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| created_by | VARCHAR(36) | å»ºç«‹è€… | NULL |

**è§’è‰²é¡å‹ (role)**:
- `owner` - æ“æœ‰è€… (æœ€é«˜æ¬Šé™)
- `manager` - ç®¡ç†å“¡ (ä¸€èˆ¬ç®¡ç†æ¬Šé™)
- `staff` - å·¥ä½œäººå“¡ (åŸºæœ¬æ¬Šé™)

**æ¬Šé™è¨­å®š (permissions)** JSON æ ¼å¼:
```json
{
  "manage_info": true,        // ç®¡ç†å»Ÿå®‡è³‡è¨Š
  "view_stats": true,          // æŸ¥çœ‹çµ±è¨ˆæ•¸æ“š
  "manage_products": true,     // ç®¡ç†å•†å“
  "manage_announcements": true,// ç®¡ç†å…¬å‘Š
  "manage_rewards": true,      // ç®¡ç†çå‹µ
  "manage_admins": false       // ç®¡ç†å…¶ä»–ç®¡ç†å“¡ (é€šå¸¸åªæœ‰ owner)
}
```

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- UNIQUE INDEX: `temple_id, user_id` (åŒä¸€ä½¿ç”¨è€…åœ¨åŒä¸€å»Ÿå®‡åªèƒ½æœ‰ä¸€å€‹è§’è‰²)
- INDEX: `temple_id`, `user_id`, `is_active`
- FOREIGN KEY: 
  - `temple_id` REFERENCES `temples(id)` ON DELETE CASCADE
  - `user_id` REFERENCES `users(id)` ON DELETE CASCADE

---

### 2. temple_announcements (å»Ÿå®‡å…¬å‘Šè¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | å…¬å‘Š UUID | PRIMARY KEY |
| temple_id | VARCHAR(36) | å»Ÿå®‡ ID | FOREIGN KEY â†’ temples.id |
| title | VARCHAR(200) | å…¬å‘Šæ¨™é¡Œ | NOT NULL |
| content | TEXT | å…¬å‘Šå…§å®¹ | NOT NULL |
| type | ENUM | å…¬å‘Šé¡å‹ | NOT NULL |
| priority | ENUM | å„ªå…ˆç´š | DEFAULT 'normal' |
| image_url | VARCHAR(500) | å…¬å‘Šåœ–ç‰‡ | NULL |
| start_date | DATETIME | é–‹å§‹é¡¯ç¤ºæ™‚é–“ | NULL |
| end_date | DATETIME | çµæŸé¡¯ç¤ºæ™‚é–“ | NULL |
| is_published | BOOLEAN | æ˜¯å¦ç™¼å¸ƒ | DEFAULT FALSE |
| view_count | INT | ç€è¦½æ¬¡æ•¸ | DEFAULT 0 |
| created_by | VARCHAR(36) | å»ºç«‹è€… | FOREIGN KEY â†’ users.id |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| updated_at | DATETIME | æ›´æ–°æ™‚é–“ | ON UPDATE CURRENT_TIMESTAMP |

**å…¬å‘Šé¡å‹ (type)**:
- `event` - æ´»å‹•é€šçŸ¥
- `festival` - ç¥­å…¸å…¬å‘Š
- `maintenance` - ç¶­è­·å…¬å‘Š
- `news` - ä¸€èˆ¬æ¶ˆæ¯
- `important` - é‡è¦å…¬å‘Š

**å„ªå…ˆç´š (priority)**:
- `low` - ä½
- `normal` - ä¸€èˆ¬
- `high` - é«˜
- `urgent` - ç·Šæ€¥

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- INDEX: `temple_id`, `is_published`, `start_date`, `end_date`
- INDEX: `type`, `priority`
- FOREIGN KEY: 
  - `temple_id` REFERENCES `temples(id)` ON DELETE CASCADE
  - `created_by` REFERENCES `users(id)` ON DELETE SET NULL

---

### 3. temple_products (å»Ÿå®‡å°ˆå±¬å•†å“è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | å•†å“ UUID | PRIMARY KEY |
| temple_id | VARCHAR(36) | å»Ÿå®‡ ID | FOREIGN KEY â†’ temples.id |
| name | VARCHAR(100) | å•†å“åç¨± | NOT NULL |
| description | TEXT | å•†å“æè¿° | NULL |
| category | VARCHAR(50) | å•†å“åˆ†é¡ | NOT NULL |
| merit_points | INT | æ‰€éœ€åŠŸå¾·å€¼ | NOT NULL |
| stock_quantity | INT | åº«å­˜æ•¸é‡ | DEFAULT 0 |
| image_url | VARCHAR(500) | å•†å“åœ–ç‰‡ | NULL |
| images | JSON | å¤šå¼µåœ–ç‰‡ | NULL |
| is_active | BOOLEAN | æ˜¯å¦ä¸Šæ¶ | DEFAULT TRUE |
| is_exclusive | BOOLEAN | æ˜¯å¦ç‚ºé™å®šå•†å“ | DEFAULT FALSE |
| sort_order | INT | æ’åºé †åº | DEFAULT 0 |
| created_by | VARCHAR(36) | å»ºç«‹è€… | FOREIGN KEY â†’ users.id |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |
| updated_at | DATETIME | æ›´æ–°æ™‚é–“ | ON UPDATE CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- INDEX: `temple_id`, `is_active`, `category`
- FOREIGN KEY:
  - `temple_id` REFERENCES `temples(id)` ON DELETE CASCADE
  - `created_by` REFERENCES `users(id)` ON DELETE SET NULL

---

### 4. checkin_rewards (æ‰“å¡çå‹µè¨­å®šè¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | çå‹µè¨­å®š UUID | PRIMARY KEY |
| temple_id | VARCHAR(36) | å»Ÿå®‡ ID | FOREIGN KEY â†’ temples.id |
| reward_type | ENUM | çå‹µé¡å‹ | NOT NULL |
| name | VARCHAR(100) | çå‹µåç¨± | NOT NULL |
| description | TEXT | çå‹µèªªæ˜ | NULL |
| bonus_points | INT | é¡å¤–åŠŸå¾·å€¼ | NOT NULL |
| condition_value | INT | æ¢ä»¶å€¼ | NULL |
| start_date | DATETIME | é–‹å§‹æ™‚é–“ | NULL |
| end_date | DATETIME | çµæŸæ™‚é–“ | NULL |
| is_active | BOOLEAN | æ˜¯å¦å•Ÿç”¨ | DEFAULT TRUE |
| max_uses | INT | æœ€å¤§ä½¿ç”¨æ¬¡æ•¸ | NULL |
| used_count | INT | å·²ä½¿ç”¨æ¬¡æ•¸ | DEFAULT 0 |
| created_by | VARCHAR(36) | å»ºç«‹è€… | FOREIGN KEY â†’ users.id |
| created_at | DATETIME | å»ºç«‹æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**çå‹µé¡å‹ (reward_type)**:
- `special_date` - ç‰¹æ®Šæ—¥æœŸ(å¦‚ç¥æ˜ç”Ÿæ—¥)
- `time_slot` - ç‰¹å®šæ™‚æ®µ(å¦‚æ—©èª²ã€æ™šèª²)
- `consecutive` - é€£çºŒæ‰“å¡ N å¤©
- `first_visit` - é¦–æ¬¡ä¾†è¨ª
- `milestone` - ç´¯è¨ˆæ‰“å¡é‡Œç¨‹ç¢‘(ç¬¬10æ¬¡ã€ç¬¬50æ¬¡ç­‰)
- `festival` - ç¯€æ…¶æ´»å‹•

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- INDEX: `temple_id`, `is_active`, `reward_type`
- INDEX: `start_date`, `end_date`
- FOREIGN KEY:
  - `temple_id` REFERENCES `temples(id)` ON DELETE CASCADE
  - `created_by` REFERENCES `users(id)` ON DELETE SET NULL

---

### 5. reward_claims (çå‹µé ˜å–è¨˜éŒ„è¡¨)

| æ¬„ä½åç¨± | è³‡æ–™å‹åˆ¥ | èªªæ˜ | ç´„æŸ |
|---------|---------|------|------|
| id | VARCHAR(36) | è¨˜éŒ„ UUID | PRIMARY KEY |
| reward_id | VARCHAR(36) | çå‹µè¨­å®š ID | FOREIGN KEY â†’ checkin_rewards.id |
| user_id | VARCHAR(36) | ä½¿ç”¨è€… ID | FOREIGN KEY â†’ users.id |
| checkin_id | VARCHAR(36) | æ‰“å¡è¨˜éŒ„ ID | FOREIGN KEY â†’ checkins.id |
| bonus_points | INT | ç²å¾—çš„é¡å¤–åŠŸå¾·å€¼ | NOT NULL |
| claimed_at | DATETIME | é ˜å–æ™‚é–“ | DEFAULT CURRENT_TIMESTAMP |

**ç´¢å¼•**:
- PRIMARY KEY: `id`
- INDEX: `reward_id`, `user_id`, `checkin_id`
- FOREIGN KEY:
  - `reward_id` REFERENCES `checkin_rewards(id)` ON DELETE CASCADE
  - `user_id` REFERENCES `users(id)` ON DELETE CASCADE
  - `checkin_id` REFERENCES `checkins(id)` ON DELETE CASCADE

---

### 6. ä¿®æ”¹ temples è¡¨ (æ–°å¢æ¬„ä½)

åœ¨ç¾æœ‰çš„ temples è¡¨ä¸­æ–°å¢ä»¥ä¸‹æ¬„ä½:

```sql
ALTER TABLE temples ADD COLUMN contact_person VARCHAR(50) COMMENT 'è¯çµ¡äºº';
ALTER TABLE temples ADD COLUMN contact_phone VARCHAR(20) COMMENT 'è¯çµ¡é›»è©±';
ALTER TABLE temples ADD COLUMN contact_email VARCHAR(120) COMMENT 'è¯çµ¡ä¿¡ç®±';
ALTER TABLE temples ADD COLUMN opening_hours JSON COMMENT 'é–‹æ”¾æ™‚é–“';
ALTER TABLE temples ADD COLUMN facilities JSON COMMENT 'è¨­æ–½è³‡è¨Š';
ALTER TABLE temples ADD COLUMN default_points INT DEFAULT 10 COMMENT 'é è¨­æ‰“å¡åŠŸå¾·å€¼';
ALTER TABLE temples ADD COLUMN website_url VARCHAR(200) COMMENT 'å®˜æ–¹ç¶²ç«™';
ALTER TABLE temples ADD COLUMN facebook_url VARCHAR(200) COMMENT 'Facebook ç²‰çµ²é ';
ALTER TABLE temples ADD COLUMN instagram_url VARCHAR(200) COMMENT 'Instagram';
```

**opening_hours** JSON æ ¼å¼ç¯„ä¾‹:
```json
{
  "monday": {"open": "06:00", "close": "21:00"},
  "tuesday": {"open": "06:00", "close": "21:00"},
  "wednesday": {"open": "06:00", "close": "21:00"},
  "thursday": {"open": "06:00", "close": "21:00"},
  "friday": {"open": "06:00", "close": "21:00"},
  "saturday": {"open": "06:00", "close": "22:00"},
  "sunday": {"open": "06:00", "close": "22:00"},
  "holidays": "24å°æ™‚é–‹æ”¾",
  "notes": "åˆä¸€ã€åäº”é–‹æ”¾è‡³åˆå¤œ"
}
```

**facilities** JSON æ ¼å¼ç¯„ä¾‹:
```json
{
  "parking": true,
  "wheelchair_accessible": true,
  "restroom": true,
  "prayer_room": true,
  "gift_shop": false,
  "cafe": false
}
```

---

## API ç«¯é»è¦æ ¼

### ğŸ” **å»Ÿæ–¹èªè­‰ç›¸é—œ**

#### 1. ç”³è«‹æˆç‚ºå»Ÿæ–¹ç®¡ç†å“¡
```
POST /api/temple-admin/apply
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "temple_id": "uuid",
  "role": "manager",
  "proof_document": "è­‰æ˜æ–‡ä»¶URL",
  "message": "ç”³è«‹èªªæ˜"
}
```

**èªªæ˜**: ä½¿ç”¨è€…ç”³è«‹æˆç‚ºæŸå»Ÿå®‡çš„ç®¡ç†å“¡,éœ€è¦ç³»çµ±ç®¡ç†å“¡å¯©æ ¸

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "ç”³è«‹å·²é€å‡º,ç­‰å¾…å¯©æ ¸",
  "data": {
    "application_id": "uuid",
    "status": "pending"
  }
}
```

---

#### 2. å–å¾—æˆ‘ç®¡ç†çš„å»Ÿå®‡åˆ—è¡¨
```
GET /api/temple-admin/my-temples
```

**èªè­‰**: éœ€è¦ (Bearer Token)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "temple_id": "uuid",
      "temple_name": "é¾å±±å¯º",
      "role": "manager",
      "permissions": {
        "manage_info": true,
        "view_stats": true,
        "manage_products": true
      },
      "is_active": true
    }
  ]
}
```

---

### ğŸ›ï¸ **å»Ÿå®‡ç®¡ç† API**

#### 3. å–å¾—å»Ÿå®‡è©³ç´°è³‡è¨Š (å»Ÿæ–¹è¦–è§’)
```
GET /api/temple-admin/temples/<temple_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "name": "é¾å±±å¯º",
    "address": "å°åŒ—å¸‚è¬è¯å€å»£å·è¡—211è™Ÿ",
    "latitude": 25.036889,
    "longitude": 121.499722,
    "main_deity": "è§€éŸ³è©è–©",
    "description": "...",
    "contact_person": "ç‹ä¸»å§”",
    "contact_phone": "02-23456789",
    "contact_email": "longshan@temple.com",
    "opening_hours": {...},
    "facilities": {...},
    "default_points": 10,
    "website_url": "https://longshan.temple.com",
    "total_checkins": 5000,
    "total_visitors": 1200,
    "avg_daily_checkins": 50
  }
}
```

---

#### 4. æ›´æ–°å»Ÿå®‡è³‡è¨Š
```
PUT /api/temple-admin/temples/<temple_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_info æ¬Šé™)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "description": "æ›´æ–°çš„å»Ÿå®‡æè¿°",
  "contact_person": "ç‹ä¸»å§”",
  "contact_phone": "02-23456789",
  "opening_hours": {...},
  "facilities": {...},
  "default_points": 15,
  "website_url": "https://temple.com",
  "facebook_url": "https://facebook.com/temple",
  "instagram_url": "https://instagram.com/temple"
}
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "å»Ÿå®‡è³‡è¨Šæ›´æ–°æˆåŠŸ",
  "data": {
    "updated_fields": ["description", "contact_phone", "default_points"]
  }
}
```

---

### ğŸ“Š **çµ±è¨ˆæ•¸æ“š API**

#### 5. å–å¾—å»Ÿå®‡çµ±è¨ˆç¸½è¦½
```
GET /api/temple-admin/temples/<temple_id>/stats/overview
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `period`: çµ±è¨ˆæœŸé–“ (today/week/month/year) (é è¨­: month)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "period": "month",
    "total_checkins": 1500,
    "unique_visitors": 350,
    "total_points_given": 15000,
    "avg_daily_checkins": 50,
    "growth_rate": 12.5,
    "popular_times": [
      {"hour": 8, "count": 120},
      {"hour": 14, "count": 90}
    ],
    "top_visitors": [
      {
        "user_id": "uuid",
        "username": "user123",
        "checkin_count": 25
      }
    ]
  }
}
```

---

#### 6. å–å¾—æ‰“å¡è¶¨å‹¢åˆ†æ
```
GET /api/temple-admin/temples/<temple_id>/stats/checkin-trend
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `start_date`: é–‹å§‹æ—¥æœŸ (YYYY-MM-DD)
- `end_date`: çµæŸæ—¥æœŸ (YYYY-MM-DD)
- `group_by`: åˆ†çµ„æ–¹å¼ (day/week/month) (é è¨­: day)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "trend": [
      {
        "date": "2025-01-01",
        "checkin_count": 45,
        "unique_visitors": 30,
        "points_given": 450
      },
      {
        "date": "2025-01-02",
        "checkin_count": 52,
        "unique_visitors": 35,
        "points_given": 520
      }
    ],
    "summary": {
      "total_checkins": 1500,
      "avg_daily_checkins": 48.5,
      "peak_date": "2025-01-15",
      "peak_count": 85
    }
  }
}
```

---

#### 7. å–å¾—è¨ªå®¢æ’è¡Œæ¦œ
```
GET /api/temple-admin/temples/<temple_id>/stats/top-visitors
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `period`: çµ±è¨ˆæœŸé–“ (week/month/year/all) (é è¨­: month)
- `limit`: å›å‚³ç­†æ•¸ (é è¨­: 20)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "rank": 1,
      "user_id": "uuid",
      "username": "è™”èª ä¿¡å¾’",
      "checkin_count": 28,
      "total_points": 350,
      "first_visit": "2024-12-01",
      "last_visit": "2025-01-15",
      "consecutive_days": 15
    }
  ]
}
```

---

#### 8. å–å¾—æ™‚æ®µåˆ†æ
```
GET /api/temple-admin/temples/<temple_id>/stats/time-analysis
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "hourly_distribution": [
      {"hour": 0, "count": 2},
      {"hour": 6, "count": 45},
      {"hour": 8, "count": 120},
      {"hour": 14, "count": 85}
    ],
    "weekday_distribution": [
      {"day": "monday", "count": 180},
      {"day": "saturday", "count": 250}
    ],
    "peak_times": {
      "morning": "08:00-09:00",
      "afternoon": "14:00-15:00",
      "evening": "18:00-19:00"
    }
  }
}
```

---

#### 9. åŒ¯å‡ºçµ±è¨ˆå ±è¡¨
```
GET /api/temple-admin/temples/<temple_id>/stats/export
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `format`: åŒ¯å‡ºæ ¼å¼ (csv/excel/pdf) (é è¨­: excel)
- `start_date`: é–‹å§‹æ—¥æœŸ
- `end_date`: çµæŸæ—¥æœŸ

**å›æ‡‰**: ä¸‹è¼‰æª”æ¡ˆ

---

### ğŸ‘¥ **è¨ªå®¢ç®¡ç† API**

#### 10. å–å¾—æ‰“å¡è¨˜éŒ„åˆ—è¡¨
```
GET /api/temple-admin/temples/<temple_id>/checkins
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `page`, `per_page`: åˆ†é 
- `start_date`, `end_date`: æ—¥æœŸç¯„åœ
- `user_id`: ç¯©é¸ç‰¹å®šä½¿ç”¨è€…

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "checkins": [
      {
        "id": "uuid",
        "user": {
          "id": "uuid",
          "username": "user123"
        },
        "checkin_time": "2025-01-15T10:30:00",
        "points_earned": 10,
        "notes": "è™”èª ç¥ˆç¦",
        "location": {
          "latitude": 25.036889,
          "longitude": 121.499722
        }
      }
    ],
    "pagination": {...}
  }
}
```

---

#### 11. å–å¾—è¨ªå®¢è©³ç´°è³‡è¨Š
```
GET /api/temple-admin/temples/<temple_id>/visitors/<user_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "username": "user123"
    },
    "visit_stats": {
      "total_visits": 25,
      "first_visit": "2024-12-01",
      "last_visit": "2025-01-15",
      "total_points_earned": 300,
      "consecutive_days": 7,
      "favorite_time": "08:00-09:00"
    },
    "recent_checkins": [...]
  }
}
```

---

### ğŸ **å»Ÿå®‡å•†å“ç®¡ç† API**

#### 12. å–å¾—å»Ÿå®‡å•†å“åˆ—è¡¨
```
GET /api/temple-admin/temples/<temple_id>/products
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "name": "é¾å±±å¯ºé™å®šå¹³å®‰ç¬¦",
      "category": "charm",
      "merit_points": 120,
      "stock_quantity": 50,
      "is_exclusive": true,
      "redemption_count": 35,
      "is_active": true
    }
  ]
}
```

---

#### 13. æ–°å¢å»Ÿå®‡å•†å“
```
POST /api/temple-admin/temples/<temple_id>/products
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_products æ¬Šé™)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "name": "é¾å±±å¯ºé™å®šå¹³å®‰ç¬¦",
  "description": "æœ¬å»Ÿé™å®šæ¬¾å¹³å®‰ç¬¦",
  "category": "charm",
  "merit_points": 120,
  "stock_quantity": 50,
  "image_url": "https://...",
  "is_exclusive": true
}
```

---

#### 14. æ›´æ–°å•†å“è³‡è¨Š
```
PUT /api/temple-admin/temples/<temple_id>/products/<product_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_products æ¬Šé™)

---

#### 15. åˆªé™¤å•†å“ (ä¸‹æ¶)
```
DELETE /api/temple-admin/temples/<temple_id>/products/<product_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_products æ¬Šé™)

---

#### 16. å–å¾—å•†å“å…Œæ›è¨˜éŒ„
```
GET /api/temple-admin/temples/<temple_id>/products/<product_id>/redemptions
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "redemptions": [
      {
        "id": "uuid",
        "user": {
          "username": "user123"
        },
        "quantity": 1,
        "status": "shipped",
        "redeemed_at": "2025-01-15T10:30:00"
      }
    ]
  }
}
```

---

#### 17. æ›´æ–°å…Œæ›ç‹€æ…‹
```
PUT /api/temple-admin/temples/<temple_id>/redemptions/<redemption_id>/status
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "status": "shipped",
  "tracking_number": "1234567890",
  "notes": "å·²æ–¼ä»Šæ—¥å‡ºè²¨"
}
```

---

### ğŸ“¢ **å…¬å‘Šç®¡ç† API**

#### 18. å–å¾—å…¬å‘Šåˆ—è¡¨
```
GET /api/temple-admin/temples/<temple_id>/announcements
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**æŸ¥è©¢åƒæ•¸**:
- `is_published`: ç¯©é¸ç™¼å¸ƒç‹€æ…‹ (true/false)
- `type`: ç¯©é¸å…¬å‘Šé¡å‹

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "title": "2025å¹´æ–°æ˜¥ç¥ˆç¦æ´»å‹•",
      "content": "...",
      "type": "event",
      "priority": "high",
      "is_published": true,
      "view_count": 350,
      "start_date": "2025-02-01",
      "end_date": "2025-02-15",
      "created_at": "2025-01-15T10:30:00"
    }
  ]
}
```

---

#### 19. æ–°å¢å…¬å‘Š
```
POST /api/temple-admin/temples/<temple_id>/announcements
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_announcements æ¬Šé™)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "title": "2025å¹´æ–°æ˜¥ç¥ˆç¦æ´»å‹•",
  "content": "è©³ç´°æ´»å‹•å…§å®¹...",
  "type": "event",
  "priority": "high",
  "image_url": "https://...",
  "start_date": "2025-02-01T00:00:00",
  "end_date": "2025-02-15T23:59:59",
  "is_published": true
}
```

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "message": "å…¬å‘Šç™¼å¸ƒæˆåŠŸ",
  "data": {
    "id": "uuid",
    "title": "2025å¹´æ–°æ˜¥ç¥ˆç¦æ´»å‹•",
    "created_at": "2025-01-15T10:30:00"
  }
}
```

---

#### 20. æ›´æ–°å…¬å‘Š
```
PUT /api/temple-admin/temples/<temple_id>/announcements/<announcement_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_announcements æ¬Šé™)

---

#### 21. åˆªé™¤å…¬å‘Š
```
DELETE /api/temple-admin/temples/<temple_id>/announcements/<announcement_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_announcements æ¬Šé™)

---

#### 22. ç™¼å¸ƒ/å–æ¶ˆç™¼å¸ƒå…¬å‘Š
```
PUT /api/temple-admin/temples/<temple_id>/announcements/<announcement_id>/publish
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_announcements æ¬Šé™)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "is_published": true
}
```

---

### ğŸ¯ **çå‹µç®¡ç† API**

#### 23. å–å¾—çå‹µè¨­å®šåˆ—è¡¨
```
GET /api/temple-admin/temples/<temple_id>/rewards
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "reward_type": "special_date",
      "name": "è§€éŸ³è©è–©è–èª•åŠ å€é€",
      "description": "è–èª•ç•¶æ—¥æ‰“å¡åŠŸå¾·å€¼x2",
      "bonus_points": 10,
      "start_date": "2025-03-19",
      "end_date": "2025-03-19",
      "is_active": true,
      "used_count": 45,
      "max_uses": null
    }
  ]
}
```

---

#### 24. æ–°å¢çå‹µè¨­å®š
```
POST /api/temple-admin/temples/<temple_id>/rewards
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_rewards æ¬Šé™)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "reward_type": "consecutive",
  "name": "é€£çºŒæ‰“å¡7å¤©çå‹µ",
  "description": "é€£çºŒ7å¤©ä¾†è¨ª,é¡å¤–ç²å¾—50åŠŸå¾·å€¼",
  "bonus_points": 50,
  "condition_value": 7,
  "is_active": true
}
```

**çå‹µé¡å‹ç¯„ä¾‹**:

1. **ç‰¹æ®Šæ—¥æœŸçå‹µ**:
```json
{
  "reward_type": "special_date",
  "name": "ç¥æ˜ç”Ÿæ—¥é›™å€é€",
  "bonus_points": 10,
  "start_date": "2025-03-19",
  "end_date": "2025-03-19"
}
```

2. **é€£çºŒæ‰“å¡çå‹µ**:
```json
{
  "reward_type": "consecutive",
  "name": "é€£çºŒæ‰“å¡7å¤©",
  "bonus_points": 50,
  "condition_value": 7
}
```

3. **é‡Œç¨‹ç¢‘çå‹µ**:
```json
{
  "reward_type": "milestone",
  "name": "ç¬¬100æ¬¡æ‰“å¡",
  "bonus_points": 200,
  "condition_value": 100
}
```

4. **é¦–æ¬¡è¨ªå•çå‹µ**:
```json
{
  "reward_type": "first_visit",
  "name": "é¦–æ¬¡æ‰“å¡ç¦®",
  "bonus_points": 20
}
```

---

#### 25. æ›´æ–°çå‹µè¨­å®š
```
PUT /api/temple-admin/temples/<temple_id>/rewards/<reward_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_rewards æ¬Šé™)

---

#### 26. åˆªé™¤çå‹µè¨­å®š
```
DELETE /api/temple-admin/temples/<temple_id>/rewards/<reward_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡ + manage_rewards æ¬Šé™)

---

#### 27. å–å¾—çå‹µé ˜å–è¨˜éŒ„
```
GET /api/temple-admin/temples/<temple_id>/rewards/<reward_id>/claims
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹ç®¡ç†å“¡)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": {
    "reward": {
      "name": "é€£çºŒæ‰“å¡7å¤©çå‹µ",
      "bonus_points": 50
    },
    "claims": [
      {
        "id": "uuid",
        "user": {
          "username": "user123"
        },
        "bonus_points": 50,
        "claimed_at": "2025-01-15T10:30:00"
      }
    ],
    "total_claims": 45,
    "total_points_given": 2250
  }
}
```

---

### ğŸ‘¨â€ğŸ’¼ **ç®¡ç†å“¡ç®¡ç† API**

#### 28. å–å¾—å»Ÿå®‡ç®¡ç†å“¡åˆ—è¡¨
```
GET /api/temple-admin/temples/<temple_id>/admins
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹æ“æœ‰è€…)

**å›æ‡‰ç¯„ä¾‹**:
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "user": {
        "id": "uuid",
        "username": "manager1",
        "email": "manager@temple.com"
      },
      "role": "manager",
      "permissions": {...},
      "is_active": true,
      "created_at": "2025-01-01"
    }
  ]
}
```

---

#### 29. æ–°å¢ç®¡ç†å“¡
```
POST /api/temple-admin/temples/<temple_id>/admins
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹æ“æœ‰è€…)

**è«‹æ±‚åƒæ•¸**:
```json
{
  "user_id": "uuid",
  "role": "manager",
  "permissions": {
    "manage_info": true,
    "view_stats": true,
    "manage_products": true,
    "manage_announcements": true,
    "manage_rewards": false
  }
}
```

---

#### 30. æ›´æ–°ç®¡ç†å“¡æ¬Šé™
```
PUT /api/temple-admin/temples/<temple_id>/admins/<admin_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹æ“æœ‰è€…)

---

#### 31. ç§»é™¤ç®¡ç†å“¡
```
DELETE /api/temple-admin/temples/<temple_id>/admins/<admin_id>
```

**èªè­‰**: éœ€è¦ (Bearer Token + å»Ÿæ–¹æ“æœ‰è€…)

---

## æ°‘çœ¾ç«¯ç›¸é—œ API (æ–°å¢)

### ğŸ“¢ **æŸ¥çœ‹å…¬å‘Š**

#### 32. å–å¾—å»Ÿå®‡å…¬å‘Šåˆ—è¡¨ (æ°‘çœ¾)
```
GET /api/temples/<temple_id>/announcements
```

**èªè­‰**: ä¸éœ€è¦

**æŸ¥è©¢åƒæ•¸**:
- `type`: ç¯©é¸å…¬å‘Šé¡å‹

**å›æ‡‰**: åªå›å‚³å·²ç™¼å¸ƒä¸”åœ¨æœ‰æ•ˆæœŸå…§çš„å…¬å‘Š

---

#### 33. æŸ¥çœ‹å…¬å‘Šè©³æƒ…
```
GET /api/temples/<temple_id>/announcements/<announcement_id>
```

**èªè­‰**: ä¸éœ€è¦

**èªªæ˜**: æœƒå¢åŠ ç€è¦½æ¬¡æ•¸

---

### ğŸ **å»Ÿå®‡å°ˆå±¬å•†å“**

#### 34. å–å¾—å»Ÿå®‡å•†å“åˆ—è¡¨ (æ°‘çœ¾)
```
GET /api/temples/<temple_id>/products
```

**èªè­‰**: ä¸éœ€è¦

**å›æ‡‰**: åªå›å‚³å·²ä¸Šæ¶ä¸”æœ‰åº«å­˜çš„å•†å“

---

## å‰ç«¯æ•´åˆç¯„ä¾‹

### JavaScript ç¯„ä¾‹

```javascript
// 1. å–å¾—æˆ‘ç®¡ç†çš„å»Ÿå®‡
async function getMyTemples() {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch('http://localhost:5000/api/temple-admin/my-temples', {
    headers: {
      'Authorization': `Bearer ${token}`
    }
  });
  
  const data = await response.json();
  return data.data;
}

// 2. æ›´æ–°å»Ÿå®‡è³‡è¨Š
async function updateTempleInfo(templeId, updateData) {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch(
    `http://localhost:5000/api/temple-admin/temples/${templeId}`,
    {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(updateData)
    }
  );
  
  return await response.json();
}

// 3. å–å¾—çµ±è¨ˆæ•¸æ“š
async function getTempleStats(templeId, period = 'month') {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch(
    `http://localhost:5000/api/temple-admin/temples/${templeId}/stats/overview?period=${period}`,
    {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    }
  );
  
  const data = await response.json();
  return data.data;
}

// 4. ç™¼å¸ƒå…¬å‘Š
async function createAnnouncement(templeId, announcementData) {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch(
    `http://localhost:5000/api/temple-admin/temples/${templeId}/announcements`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(announcementData)
    }
  );
  
  return await response.json();
}

// 5. æ–°å¢çå‹µæ´»å‹•
async function createReward(templeId, rewardData) {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch(
    `http://localhost:5000/api/temple-admin/temples/${templeId}/rewards`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(rewardData)
    }
  );
  
  return await response.json();
}

// 6. ä¸Šæ¶å»Ÿå®‡å•†å“
async function createTempleProduct(templeId, productData) {
  const token = localStorage.getItem('access_token');
  
  const response = await fetch(
    `http://localhost:5000/api/temple-admin/temples/${templeId}/products`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify(productData)
    }
  );
  
  return await response.json();
}
```

---

## æ¥­å‹™è¦å‰‡

### æ¬Šé™ç®¡ç†
1. **è§’è‰²å±¤ç´š**: owner > manager > staff
2. **æ“æœ‰è€…æ¬Šé™**: å¯ä»¥ç®¡ç†å…¶ä»–ç®¡ç†å“¡ã€æ‰€æœ‰åŠŸèƒ½
3. **ç®¡ç†å“¡æ¬Šé™**: æ ¹æ“š permissions è¨­å®šæ±ºå®š
4. **å·¥ä½œäººå“¡æ¬Šé™**: åƒ…èƒ½æŸ¥çœ‹çµ±è¨ˆå’Œè™•ç†è¨‚å–®

### çå‹µæ©Ÿåˆ¶
1. **çå‹µç–ŠåŠ **: å¤šå€‹çå‹µå¯ä»¥åŒæ™‚ç”Ÿæ•ˆ
2. **çå‹µå„ªå…ˆç´š**: ç‰¹æ®Šæ—¥æœŸ > é€£çºŒæ‰“å¡ > é‡Œç¨‹ç¢‘
3. **é ˜å–é™åˆ¶**: æ¯å€‹çå‹µä½¿ç”¨è€…åªèƒ½é ˜å–ä¸€æ¬¡(é™¤éè¨­å®šå¯é‡è¤‡)
4. **è‡ªå‹•è§¸ç™¼**: æ‰“å¡æ™‚è‡ªå‹•æª¢æŸ¥ä¸¦ç™¼æ”¾ç¬¦åˆæ¢ä»¶çš„çå‹µ

### å…¬å‘Šç®¡ç†
1. **é¡¯ç¤ºè¦å‰‡**: åªé¡¯ç¤ºå·²ç™¼å¸ƒä¸”åœ¨æœ‰æ•ˆæœŸå…§çš„å…¬å‘Š
2. **å„ªå…ˆç´šæ’åº**: ç·Šæ€¥ > é«˜ > ä¸€èˆ¬ > ä½
3. **åˆ°æœŸè™•ç†**: éæœŸå…¬å‘Šè‡ªå‹•ä¸é¡¯ç¤º(ä¸åˆªé™¤)

### å•†å“ç®¡ç†
1. **å»Ÿå®‡å°ˆå±¬**: åªæœ‰è©²å»Ÿå®‡çš„ä¿¡å¾’å¯ä»¥å…Œæ›
2. **åº«å­˜ç®¡ç†**: èˆ‡ä¸€èˆ¬å•†å“ç›¸åŒæ©Ÿåˆ¶
3. **å…Œæ›è™•ç†**: ç”±å»Ÿæ–¹ç®¡ç†å“¡è² è²¬å‡ºè²¨

---

## å®‰å…¨æ€§è€ƒé‡

### 1. æ¬Šé™é©—è­‰
- æ¯å€‹ API éƒ½éœ€è¦é©—è­‰ä½¿ç”¨è€…æ˜¯å¦ç‚ºè©²å»Ÿå®‡çš„ç®¡ç†å“¡
- æª¢æŸ¥ç®¡ç†å“¡çš„æ¬Šé™è¨­å®š
- è¨˜éŒ„æ‰€æœ‰ç®¡ç†æ“ä½œçš„æ—¥èªŒ

### 2. è³‡æ–™ä¿è­·
- è¨ªå®¢å€‹è³‡åªé¡¯ç¤ºå¿…è¦è³‡è¨Š
- æ•æ„Ÿçµ±è¨ˆæ•¸æ“šéœ€è¦ç‰¹å®šæ¬Šé™
- é˜²æ­¢è·¨å»Ÿå®‡è³‡æ–™å­˜å–

### 3. ç”³è«‹å¯©æ ¸
- æˆç‚ºå»Ÿæ–¹ç®¡ç†å“¡éœ€è¦ç³»çµ±ç®¡ç†å“¡å¯©æ ¸
- éœ€è¦æä¾›è­‰æ˜æ–‡ä»¶
- é¿å…æƒ¡æ„ç”³è«‹

---

## æœªä¾†æ“´å……å»ºè­°

1. **æ¨æ’­é€šçŸ¥**: å‘å¸¸ä¾†çš„ä¿¡å¾’æ¨æ’­æ´»å‹•è¨Šæ¯
2. **æ•¸æ“šåˆ†æ**: AI åˆ†æè¨ªå®¢è¡Œç‚º,æä¾›å»ºè­°
3. **ç·šä¸Šé»ç‡ˆ**: ç·šä¸Šé»ç‡ˆé ç´„åŠŸèƒ½
4. **ç¥ˆç¦å¡**: ç·šä¸Šç¥ˆç¦ç•™è¨€ç‰†
5. **ç›´æ’­åŠŸèƒ½**: æ³•æœƒç›´æ’­
6. **å‹Ÿæ¬¾åŠŸèƒ½**: ç·šä¸ŠåŠŸå¾·æ¬¾
7. **å¿—å·¥ç®¡ç†**: å¿—å·¥æ’ç­ç³»çµ±
8. **è¨­æ–½é ç´„**: å ´åœ°ã€æ³•å™¨é ç´„

---

**ç‰ˆæœ¬**: 1.0.0  
**æœ€å¾Œæ›´æ–°**: 2025-01-15
